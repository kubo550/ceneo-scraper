<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jakub Kurdziel App</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Navbar -->
    <div class="container">
      <header class="d-flex justify-content-center py-3">
        <ul class="nav nav-pills">
          <li class="nav-item">
            <a href="/" class="nav-link" aria-current="page">Home</a>
          </li>
          <li class="nav-item">
            <a href="/about" class="nav-link">O autorze</a>
          </li>
          <li class="nav-item">
            <a href="/product" class="nav-link">Ekstrakcja opinii</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link active">Lista produktów</a>
          </li>
        </ul>
      </header>

      <h1>
        Przeglądasz Statystyki dla produktu od id
        <a href="https://www.ceneo.pl/{{ id }}" target="_blank"> {{ id }} </a>
      </h1>

      <canvas id="myChart"></canvas>
      <canvas id="myChart2"></canvas>
    </div>

    <script>
      let product_data = "{{ product_data }}";
      product_data = JSON.parse(
        product_data
          .replace(/&#39;/gm, '"')
          .replace(/True/gm, "true")
          .replace(/False/gm, "false")
          .replace(/None/gm, "null")
          .replace(/\n/gm, "")
      );

      let score = "{{ rating }}";
      score = JSON.parse(
        score
          .replace(/&#39;/gm, '"')
          .replace(/True/gm, "true")
          .replace(/False/gm, "false")
          .replace(/None/gm, "null")
          .replace(/\n/gm, "")
      );

      const labels = Object.keys(product_data);
      const dataValues = Object.values(product_data);
      const data = {
        labels: labels,
        datasets: [
          {
            label: "Dataset 1",
            data: dataValues,
            backgroundColor: ["#36A2EB", "#FF6384"],
          },
        ],
      };

      const config = {
        type: "pie",
        data,
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "top",
            },
            title: {
              display: true,
              text: "Opinie produktu",
            },
          },
        },
      };

      const myChart = new Chart(document.getElementById("myChart"), config);

      //   TODO
      console.log(score);

      const data2 = {
        labels: Object.keys(score),
        datasets: [
          {
            label: "Ocena produktu",
            backgroundColor: [
              "#FF0000",
              "#ff6600",
              "#ff9900",
              "#FFCC00",
              "#FFFF00",
              "#ccff00",
              "#99ff00",
              "#33ff00",
              "#00FF00",
            ],

            data: Object.values(score),
          },
        ],
      };

      const config2 = {
        type: "bar",
        data: data2,
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "top",
            },
            title: {
              display: true,
              text: "Chart.js Floating Bar Chart",
            },
          },
        },
      };

      const myChart2 = new Chart(document.getElementById("myChart2"), config2);
    </script>
  </body>
</html>
